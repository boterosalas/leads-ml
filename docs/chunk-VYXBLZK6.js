import{b as C,c as A,g as x,l as T,n as S,p as k}from"./chunk-T3A5QWO2.js";import{Ea as c,Fa as u,Ha as h,Ia as m,K as v,M as n,N as b,R as y,S as r,wa as g,xa as _}from"./chunk-E6PDLGFJ.js";var i=class{};var s=class o{constructor(e){this._authGatewayService=e}getCode(){return this._authGatewayService.getCode()}getAccessToken(e){return this._authGatewayService.getAccessToken(e)}getLeads(){return this._authGatewayService.getLeads()}useProxy(e){return this._authGatewayService.useProxy(e)}static \u0275fac=function(t){return new(t||o)(y(i))};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};var p=class o{_authUsecaseService=r(s);_activatedRoute=r(T);_router=r(S);_location=r(C);ngOnInit(){this.listenToCode()}getCode(){console.log("getCode desde el componente"),this._authUsecaseService.getCode()}listenToCode(){this._activatedRoute.queryParams.subscribe(e=>{let t=e.code||null;t&&(console.log("code",t),this.reInitUrl(),this.getAccessToken(t))})}getLeads(){this._authUsecaseService.getLeads().subscribe(e=>{console.log({data:e})})}getAccessToken(e){this._authUsecaseService.getAccessToken(e).subscribe(t=>{console.log({data:t})})}reInitUrl(){console.log("reInitUrl"),this._location.replaceState(this._router.url.split("?")[0])}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=g({type:o,selectors:[["app-auth"]],decls:6,vars:0,consts:[[3,"click"]],template:function(t,a){t&1&&(c(0,"h1"),m(1,"Auth"),u(),c(2,"button",0),h("click",function(){return a.getCode()}),m(3,"getCode"),u(),c(4,"button",0),h("click",function(){return a.getLeads()}),m(5,"getLeads"),u())},encapsulation:2})};var w=[{path:"",component:p}];var l={redirectUri:"https://boterosalas.github.io/leads-ml/",clientId:"8315944344732576"};var d=class o{_httpClient=r(x);apiUrl="https://2o8i6bmmue.execute-api.us-east-1.amazonaws.com/MeliDevStage/trigger";token="";getCode(){console.log("getCode desde el servicio"),window.location.href=`https://auth.mercadolibre.com.co/authorization?response_type=code&client_id=${l.clientId}&redirect_uri=${l.redirectUri}`}getAccessToken(e){let t={method:"POST",url:"https://api.mercadolibre.com/oauth/token",data:{code:e,grant_type:"authorization_code",redirect_uri:l.redirectUri,client_id:"8315944344732576",client_secret:"rAsZB2GwlsivbGp4GE5CANWw0ulMTizu"},headers:{"Content-Type":"application/json"}};return this.useProxy(t).pipe(v(a=>{a&&(this.token=a.access_token,console.log(`token: ${this.token}`))}))}getLeads(){let e={method:"GET",url:"https://api.mercadolibre.com/vis/users/2651263697/leads/buyers",headers:{Authorization:`Bearer ${this.token}`}};return this.useProxy(e)}useProxy(e){return this._httpClient.post(this.apiUrl,e)}static \u0275fac=function(t){return new(t||o)};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};var P=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=_({type:o});static \u0275inj=b({providers:[s,{provide:i,useClass:d}],imports:[A,k.forChild(w)]})};export{P as AuthModule};
