import{b as x,c as A,g as T,l as S,n as k,p as w}from"./chunk-PNVX5LN2.js";import{Ea as c,Fa as p,Ha as h,Ia as u,K as y,M as n,N as b,R as g,S as i,r as v,wa as C,xa as _}from"./chunk-ET7LY2AO.js";var s=class{};var a=class o{constructor(t){this._authGatewayService=t}getCode(){return this._authGatewayService.getCode()}getAccessToken(t){return this._authGatewayService.getAccessToken(t)}getLeads(){return this._authGatewayService.getLeads()}useProxy(t){return this._authGatewayService.useProxy(t)}static \u0275fac=function(e){return new(e||o)(g(s))};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};var m=class o{_authUsecaseService=i(a);_activatedRoute=i(S);_router=i(k);_location=i(x);ngOnInit(){this.listenToCode()}getCode(){console.log("getCode desde el componente"),this._authUsecaseService.getCode()}listenToCode(){this._activatedRoute.queryParams.subscribe(t=>{let e=t.code||null;e&&(console.log("code",e),this.reInitUrl(),this.getAccessToken(e))})}getLeads(){this._authUsecaseService.getLeads().subscribe(t=>{console.log({data:t})})}getAccessToken(t){this._authUsecaseService.getAccessToken(t).subscribe(e=>{console.log({data:e})})}reInitUrl(){console.log("reInitUrl"),this._location.replaceState(this._router.url.split("?")[0])}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=C({type:o,selectors:[["app-auth"]],decls:6,vars:0,consts:[[3,"click"]],template:function(e,r){e&1&&(c(0,"h1"),u(1,"Auth"),p(),c(2,"button",0),h("click",function(){return r.getCode()}),u(3,"getCode"),p(),c(4,"button",0),h("click",function(){return r.getLeads()}),u(5,"getLeads"),p())},encapsulation:2})};var P=[{path:"",component:m}];var l={redirectUri:"https://boterosalas.github.io/leads-ml/",clientId:"8315944344732576"};var d=class o{_httpClient=i(T);apiUrl="https://2o8i6bmmue.execute-api.us-east-1.amazonaws.com/MeliDevStage/trigger";token="";getCode(){console.log("getCode desde el servicio"),window.location.href=`https://auth.mercadolibre.com.co/authorization?response_type=code&client_id=${l.clientId}&redirect_uri=${l.redirectUri}`}getAccessToken(t){let e={method:"POST",url:"https://api.mercadolibre.com/oauth/token",data:{code:t,grant_type:"authorization_code",redirect_uri:l.redirectUri,client_id:"8315944344732576",client_secret:"rAsZB2GwlsivbGp4GE5CANWw0ulMTizu"},headers:{"Content-Type":"application/json"}};return this.useProxy(e).pipe(y(r=>{this.token=r.accessToken,console.log(`token: ${this.token}`)}))}useProxy(t){return this._httpClient.post(this.apiUrl,t).pipe(v(e=>{let r;try{r=typeof e.body=="string"?JSON.parse(e.body):e.body}catch{r=e.body}return r}))}getLeads(){let t={method:"GET",url:"https://api.mercadolibre.com/oauth/token",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.token}`}};return this.useProxy(t)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};var R=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=_({type:o});static \u0275inj=b({providers:[a,{provide:s,useClass:d}],imports:[A,w.forChild(P)]})};export{R as AuthModule};
