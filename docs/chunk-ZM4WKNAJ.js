import{$ as E,T as R,V as O,Y as U,Z as j,_ as P,ba as q,da as v,ga as z,ha as D,ia as B,ja as $,ka as g,la as J,ma as V,oa as L,pa as W,qa as Z,ra as H,sa as K,ua as Q,va as X}from"./chunk-LCZU7PSD.js";import{c as M,f as F,q as T,s as G,u as N}from"./chunk-FTFA6R7I.js";import"./chunk-PJU3RY6S.js";import{Cb as n,Db as a,Eb as h,Lb as k,V as x,Xb as c,Y as l,Ya as f,Z as I,ba as w,ca as i,ib as _,jb as A,p as C,tb as d}from"./chunk-M564NXSW.js";var s=class{};var m=class o{constructor(t){this._authGatewayService=t}getCode(t){return this._authGatewayService.getCode(t)}getAccessToken(t){return this._authGatewayService.getAccessToken(t)}static \u0275fac=function(e){return new(e||o)(w(s))};static \u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})};var u=class o{_authUsecaseService=i(m);_activatedRoute=i(T);_router=i(G);_location=i(M);authForm;clientIdControl=new g(null,v.required);clientSecretControl=new g(null,v.required);ngOnInit(){this.initForm(),this.listenToCode()}initForm(){this.authForm=new B({clientId:this.clientIdControl,clientSecret:this.clientSecretControl})}listenToCode(){this._activatedRoute.queryParams.subscribe(t=>{let e=t.code||null;e&&(this.reInitUrl(),this.getAccessToken(e))})}getAccessToken(t){this._authUsecaseService.getAccessToken(t).subscribe(e=>{localStorage.setItem("token",JSON.stringify(e)),this._router.navigateByUrl("/leads")})}reInitUrl(){this._location.replaceState(this._router.url.split("?")[0])}connect(){if(this.authForm.valid){let t={clientId:this.clientIdControl.value,clientSecret:this.clientSecretControl.value};localStorage.setItem("keys",JSON.stringify(t)),this._authUsecaseService.getCode(`${this.clientIdControl.value}`)}}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=_({type:o,selectors:[["app-auth"]],decls:21,vars:2,consts:[[1,"auth-section"],[1,"form-container"],[1,"form-group"],[1,"form-title"],[1,"form-field"],["appearance","outline"],["matInput","",3,"formControl"],["matSuffix",""],["mat-flat-button","",1,"form__btn-connect",3,"click"]],template:function(e,r){e&1&&(n(0,"section",0)(1,"div",1)(2,"form",2)(3,"h1",3),c(4,"Conexi\xF3n API"),a(),n(5,"div",4)(6,"mat-form-field",5)(7,"mat-label"),c(8,"Client ID"),a(),h(9,"input",6),n(10,"mat-icon",7),c(11,"fingerprint"),a()()(),n(12,"div",4)(13,"mat-form-field",5)(14,"mat-label"),c(15,"Client Secret"),a(),h(16,"input",6),n(17,"mat-icon",7),c(18,"key"),a()()(),n(19,"button",8),k("click",function(){return r.connect()}),c(20," Conectar "),a()()()()),e&2&&(f(9),d("formControl",r.clientIdControl),f(7),d("formControl",r.clientSecretControl))},dependencies:[j,U,R,O,H,Z,E,P,Q,K,L,J,q,z,D,$,W,V],styles:[`.auth-section{display:flex;flex-direction:row;align-items:center;justify-content:center;width:100%;height:100vh;padding:16px}.auth-section .form-container{width:100%;max-width:500px;height:auto;max-height:90vh;overflow:auto;padding:50px 40px;box-shadow:0 .5rem 1rem #00000026;background-color:#ffffffb3;border-radius:12px}.auth-section .form-container .form-title{font-size:4rem;font-weight:700;color:#003965;text-align:center}.auth-section .form-container .form-group{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;position:sticky;z-index:1}.auth-section .form-container .form-group .form-field,.auth-section .form-container .form-group .form-field .mat-mdc-form-field{width:100%}.auth-section .form-container .form-group .form__btn-connect{background:#003965}
`],encapsulation:2})};var Y=[{path:"",component:u,pathMatch:"full"}];var b={redirectUri:"https://boterosalas.github.io/leads-ml/",clientId:"8315944344732576",clientSecret:"rAsZB2GwlsivbGp4GE5CANWw0ulMTizu"};var p=class o{_proxy=i(X);getCode(t){window.location.href=`https://auth.mercadolibre.com.co/authorization?response_type=code&client_id=${t}&redirect_uri=${b.redirectUri}`}getAccessToken(t){let{clientId:e,clientSecret:r}=JSON.parse(`${localStorage.getItem("keys")}`),S={method:"POST",url:"https://api.mercadolibre.com/oauth/token",data:{code:t,grant_type:"authorization_code",redirect_uri:b.redirectUri,client_id:e,client_secret:r},headers:{"Content-Type":"application/json"}};return this._proxy.useProxy(S).pipe(x(et=>{console.log("token from getAccessToken",et)}))}getMe(){let t=localStorage.getItem("token");if(t){let{access_token:e}=JSON.parse(t),r={method:"GET",url:"https://api.mercadolibre.com/users/me",headers:{Authorization:`Bearer ${e}`}};return this._proxy.useProxy(r)}return C(()=>new Error("No token provided"))}static \u0275fac=function(e){return new(e||o)};static \u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})};var tt=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=A({type:o});static \u0275inj=I({providers:[m,{provide:s,useClass:p}],imports:[F,N.forChild(Y)]})};export{tt as AuthModule};
